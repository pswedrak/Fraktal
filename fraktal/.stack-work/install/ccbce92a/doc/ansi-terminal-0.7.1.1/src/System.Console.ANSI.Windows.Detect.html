<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_HADDOCK hide #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Console</span><span class="hs-operator">.</span><span class="hs-identifier">ANSI</span><span class="hs-operator">.</span><span class="hs-identifier">Windows</span><span class="hs-operator">.</span><span class="hs-identifier">Detect</span><span>
</span><a name="line-4"></a><span class="hs-special">(</span><span>
</span><a name="line-5"></a><span>  </span><a href="System.Console.ANSI.Windows.Detect.html#ANSIEnabledStatus"><span class="hs-identifier hs-type">ANSIEnabledStatus</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-6"></a><span class="hs-special">,</span><span> </span><a href="System.Console.ANSI.Windows.Detect.html#ConsoleDefaultState"><span class="hs-identifier hs-type">ConsoleDefaultState</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-7"></a><span class="hs-special">,</span><span> </span><a href="System.Console.ANSI.Windows.Detect.html#isANSIEnabled"><span class="hs-identifier hs-var">isANSIEnabled</span></a><span>
</span><a name="line-8"></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Exception</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">SomeException</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">throwIO</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">try</span><span class="hs-special">)</span><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Bits</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">.&amp;.</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.|.</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><a href="System.Console.ANSI.Windows.Foreign.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Console</span><span class="hs-operator">.</span><span class="hs-identifier">ANSI</span><span class="hs-operator">.</span><span class="hs-identifier">Windows</span><span class="hs-operator">.</span><span class="hs-identifier">Foreign</span></a><span> </span><span class="hs-special">(</span><a href="System.Console.ANSI.Windows.Foreign.html#bACKGROUND_INTENSE_WHITE"><span class="hs-identifier hs-var">bACKGROUND_INTENSE_WHITE</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>    </span><a href="System.Console.ANSI.Windows.Foreign.html#ConsoleException"><span class="hs-identifier hs-type">ConsoleException</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="System.Console.ANSI.Windows.Foreign.html#CONSOLE_SCREEN_BUFFER_INFO"><span class="hs-identifier hs-type">CONSOLE_SCREEN_BUFFER_INFO</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">DWORD</span><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>    </span><a href="System.Console.ANSI.Windows.Foreign.html#eNABLE_VIRTUAL_TERMINAL_PROCESSING"><span class="hs-identifier hs-var">eNABLE_VIRTUAL_TERMINAL_PROCESSING</span></a><span class="hs-special">,</span><span> </span><a href="System.Console.ANSI.Windows.Foreign.html#fOREGROUND_INTENSE_WHITE"><span class="hs-identifier hs-var">fOREGROUND_INTENSE_WHITE</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>    </span><a href="System.Console.ANSI.Windows.Foreign.html#getConsoleMode"><span class="hs-identifier hs-var">getConsoleMode</span></a><span class="hs-special">,</span><span> </span><a href="System.Console.ANSI.Windows.Foreign.html#getConsoleScreenBufferInfo"><span class="hs-identifier hs-var">getConsoleScreenBufferInfo</span></a><span class="hs-special">,</span><span> </span><a href="System.Console.ANSI.Windows.Foreign.html#getStdHandle"><span class="hs-identifier hs-var">getStdHandle</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">HANDLE</span><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>    </span><span class="hs-identifier hs-var">iNVALID_HANDLE_VALUE</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nullHANDLE</span><span class="hs-special">,</span><span> </span><a href="System.Console.ANSI.Windows.Foreign.html#setConsoleMode"><span class="hs-identifier hs-var">setConsoleMode</span></a><span class="hs-special">,</span><span> </span><a href="System.Console.ANSI.Windows.Foreign.html#sTD_OUTPUT_HANDLE"><span class="hs-identifier hs-var">sTD_OUTPUT_HANDLE</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">WORD</span><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span class="hs-comment">-- 'lookupEnv' is not available until base-4.6.0.0 (GHC 7.6.1)</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Environment</span><span class="hs-operator">.</span><span class="hs-identifier">Compat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lookupEnv</span><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Unsafe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unsafePerformIO</span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-comment">-- | The default state of the console</span><span>
</span><a name="line-22"></a><span class="hs-keyword">data</span><span> </span><a name="ConsoleDefaultState"><a href="System.Console.ANSI.Windows.Detect.html#ConsoleDefaultState"><span class="hs-identifier">ConsoleDefaultState</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ConsoleDefaultState"><a href="System.Console.ANSI.Windows.Detect.html#ConsoleDefaultState"><span class="hs-identifier">ConsoleDefaultState</span></a></a><span>
</span><a name="line-23"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="defaultForegroundAttributes"><a href="System.Console.ANSI.Windows.Detect.html#defaultForegroundAttributes"><span class="hs-identifier">defaultForegroundAttributes</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">WORD</span><span> </span><span class="hs-comment">-- ^ Foreground attributes</span><span>
</span><a name="line-24"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="defaultBackgroundAttributes"><a href="System.Console.ANSI.Windows.Detect.html#defaultBackgroundAttributes"><span class="hs-identifier">defaultBackgroundAttributes</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">WORD</span><span> </span><span class="hs-comment">-- ^ Background attributes</span><span>
</span><a name="line-25"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-comment">-- | The status of the console as regards it being ANSI-enabled or not</span><span>
</span><a name="line-28"></a><span class="hs-comment">-- ANSI-enabled.</span><span>
</span><a name="line-29"></a><span class="hs-keyword">data</span><span> </span><a name="ANSIEnabledStatus"><a href="System.Console.ANSI.Windows.Detect.html#ANSIEnabledStatus"><span class="hs-identifier">ANSIEnabledStatus</span></a></a><span>
</span><a name="line-30"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="ANSIEnabled"><a href="System.Console.ANSI.Windows.Detect.html#ANSIEnabled"><span class="hs-identifier">ANSIEnabled</span></a></a><span> </span><span class="hs-comment">-- ^ ANSI-enabled</span><span>
</span><a name="line-31"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="NotANSIEnabled"><a href="System.Console.ANSI.Windows.Detect.html#NotANSIEnabled"><span class="hs-identifier">NotANSIEnabled</span></a></a><span> </span><a href="System.Console.ANSI.Windows.Detect.html#ConsoleDefaultState"><span class="hs-identifier hs-type">ConsoleDefaultState</span></a><span> </span><span class="hs-comment">-- ^ Not ANSI-enabled (including the</span><span>
</span><a name="line-32"></a><span>                                         </span><span class="hs-comment">-- state of the console when that</span><span>
</span><a name="line-33"></a><span>                                         </span><span class="hs-comment">-- status was determined)</span><span>
</span><a name="line-34"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span class="hs-comment">-- | This function assumes that once it is first established whether or not the</span><span>
</span><a name="line-37"></a><span class="hs-comment">-- Windows console is ANSI-enabled, that will not change. If the console is not</span><span>
</span><a name="line-38"></a><span class="hs-comment">-- ANSI-enabled, the state of the console is considered to be its default state.</span><span>
</span><a name="line-39"></a><span class="hs-pragma">{-# NOINLINE isANSIEnabled #-}</span><span>
</span><a name="line-40"></a><span class="hs-identifier">isANSIEnabled</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Console.ANSI.Windows.Detect.html#ANSIEnabledStatus"><span class="hs-identifier hs-type">ANSIEnabledStatus</span></a><span>
</span><a name="line-41"></a><a name="isANSIEnabled"><a href="System.Console.ANSI.Windows.Detect.html#isANSIEnabled"><span class="hs-identifier">isANSIEnabled</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unsafePerformIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-42"></a><span>    </span><a name="local-6989586621679053436"><a href="#local-6989586621679053436"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Console.ANSI.Windows.Detect.html#safeIsANSIEnabled"><span class="hs-identifier hs-var">safeIsANSIEnabled</span></a><span>
</span><a name="line-43"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679053436"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-44"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="System.Console.ANSI.Windows.Detect.html#ANSIEnabled"><span class="hs-identifier hs-var">ANSIEnabled</span></a><span>
</span><a name="line-45"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-46"></a><span>            </span><a name="local-6989586621679053437"><a href="#local-6989586621679053437"><span class="hs-identifier">hOut</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Console.ANSI.Windows.Detect.html#getValidStdHandle"><span class="hs-identifier hs-var">getValidStdHandle</span></a><span> </span><a href="System.Console.ANSI.Windows.Foreign.html#sTD_OUTPUT_HANDLE"><span class="hs-identifier hs-var">sTD_OUTPUT_HANDLE</span></a><span>
</span><a name="line-47"></a><span>            </span><a name="local-6989586621679053438"><a href="#local-6989586621679053438"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Console.ANSI.Windows.Foreign.html#getConsoleScreenBufferInfo"><span class="hs-identifier hs-var">getConsoleScreenBufferInfo</span></a><span> </span><a href="#local-6989586621679053437"><span class="hs-identifier hs-var">hOut</span></a><span>
</span><a name="line-48"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679053439"><a href="#local-6989586621679053439"><span class="hs-identifier">attributes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">csbi_attributes</span><span> </span><a href="#local-6989586621679053438"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-49"></a><span>                </span><a name="local-6989586621679053440"><a href="#local-6989586621679053440"><span class="hs-identifier">fgAttributes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679053439"><span class="hs-identifier hs-var">attributes</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><a href="System.Console.ANSI.Windows.Foreign.html#fOREGROUND_INTENSE_WHITE"><span class="hs-identifier hs-var">fOREGROUND_INTENSE_WHITE</span></a><span>
</span><a name="line-50"></a><span>                </span><a name="local-6989586621679053441"><a href="#local-6989586621679053441"><span class="hs-identifier">bgAttributes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679053439"><span class="hs-identifier hs-var">attributes</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><a href="System.Console.ANSI.Windows.Foreign.html#bACKGROUND_INTENSE_WHITE"><span class="hs-identifier hs-var">bACKGROUND_INTENSE_WHITE</span></a><span>
</span><a name="line-51"></a><span>                </span><a name="local-6989586621679053442"><a href="#local-6989586621679053442"><span class="hs-identifier">consoleDefaultState</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Console.ANSI.Windows.Detect.html#ConsoleDefaultState"><span class="hs-identifier hs-var">ConsoleDefaultState</span></a><span>
</span><a name="line-52"></a><span>                    </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">defaultForegroundAttributes</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679053440"><span class="hs-identifier hs-var">fgAttributes</span></a><span>
</span><a name="line-53"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">defaultBackgroundAttributes</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679053441"><span class="hs-identifier hs-var">bgAttributes</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-54"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Console.ANSI.Windows.Detect.html#NotANSIEnabled"><span class="hs-identifier hs-var">NotANSIEnabled</span></a><span> </span><a href="#local-6989586621679053442"><span class="hs-identifier hs-var">consoleDefaultState</span></a><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-comment">-- This function takes the following approach. If the environment variable TERM</span><span>
</span><a name="line-57"></a><span class="hs-comment">-- exists and is not set to 'dumb' or 'msys' (see below), it assumes the console</span><span>
</span><a name="line-58"></a><span class="hs-comment">-- is ANSI-enabled. Otherwise, it tries to enable virtual terminal processing.</span><span>
</span><a name="line-59"></a><span class="hs-comment">-- If that fails, it assumes the console is not ANSI-enabled.</span><span>
</span><a name="line-60"></a><span class="hs-comment">--</span><span>
</span><a name="line-61"></a><span class="hs-comment">-- In Git Shell, if Command Prompt or PowerShell are used, the environment</span><span>
</span><a name="line-62"></a><span class="hs-comment">-- variable TERM is set to 'msys'. If 'Git Bash' (mintty) is used, TERM is set</span><span>
</span><a name="line-63"></a><span class="hs-comment">-- to 'xterm' (by default).</span><span>
</span><a name="line-64"></a><span class="hs-identifier">safeIsANSIEnabled</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-65"></a><a name="safeIsANSIEnabled"><a href="System.Console.ANSI.Windows.Detect.html#safeIsANSIEnabled"><span class="hs-identifier">safeIsANSIEnabled</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-66"></a><span>    </span><a name="local-6989586621679053443"><a href="#local-6989586621679053443"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">lookupEnv</span><span> </span><span class="hs-string">&quot;TERM&quot;</span><span>
</span><a name="line-67"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679053443"><span class="hs-identifier hs-var">result</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-68"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-string">&quot;dumb&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-69"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-string">&quot;msys&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.ANSI.Windows.Detect.html#doesEnableANSIOutSucceed"><span class="hs-identifier hs-var">doesEnableANSIOutSucceed</span></a><span>
</span><a name="line-70"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-71"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.ANSI.Windows.Detect.html#doesEnableANSIOutSucceed"><span class="hs-identifier hs-var">doesEnableANSIOutSucceed</span></a><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-comment">-- This function returns whether or not an attempt to enable virtual terminal</span><span>
</span><a name="line-74"></a><span class="hs-comment">-- processing succeeded, in the IO monad.</span><span>
</span><a name="line-75"></a><span class="hs-identifier">doesEnableANSIOutSucceed</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-76"></a><a name="doesEnableANSIOutSucceed"><a href="System.Console.ANSI.Windows.Detect.html#doesEnableANSIOutSucceed"><span class="hs-identifier">doesEnableANSIOutSucceed</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-77"></a><span>    </span><a name="local-6989586621679053578"><a href="#local-6989586621679053578"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">try</span><span> </span><a href="System.Console.ANSI.Windows.Detect.html#enableANSIOut"><span class="hs-identifier hs-var">enableANSIOut</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">SomeException</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679053578"><span class="hs-identifier hs-var">result</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-79"></a><span>        </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-80"></a><span>        </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span class="hs-comment">-- This function tries to enable virtual terminal processing on the standard</span><span>
</span><a name="line-83"></a><span class="hs-comment">-- output and throws an exception if it cannot.</span><span>
</span><a name="line-84"></a><span class="hs-identifier">enableANSIOut</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-85"></a><a name="enableANSIOut"><a href="System.Console.ANSI.Windows.Detect.html#enableANSIOut"><span class="hs-identifier">enableANSIOut</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-86"></a><span>    </span><a name="local-6989586621679053579"><a href="#local-6989586621679053579"><span class="hs-identifier">hOut</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Console.ANSI.Windows.Detect.html#getValidStdHandle"><span class="hs-identifier hs-var">getValidStdHandle</span></a><span> </span><a href="System.Console.ANSI.Windows.Foreign.html#sTD_OUTPUT_HANDLE"><span class="hs-identifier hs-var">sTD_OUTPUT_HANDLE</span></a><span>
</span><a name="line-87"></a><span>    </span><a name="local-6989586621679053580"><a href="#local-6989586621679053580"><span class="hs-identifier">mOut</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Console.ANSI.Windows.Foreign.html#getConsoleMode"><span class="hs-identifier hs-var">getConsoleMode</span></a><span> </span><a href="#local-6989586621679053579"><span class="hs-identifier hs-var">hOut</span></a><span>
</span><a name="line-88"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679053581"><a href="#local-6989586621679053581"><span class="hs-identifier">mOut'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679053580"><span class="hs-identifier hs-var">mOut</span></a><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><a href="System.Console.ANSI.Windows.Foreign.html#eNABLE_VIRTUAL_TERMINAL_PROCESSING"><span class="hs-identifier hs-var">eNABLE_VIRTUAL_TERMINAL_PROCESSING</span></a><span>
</span><a name="line-89"></a><span>    </span><a href="System.Console.ANSI.Windows.Foreign.html#setConsoleMode"><span class="hs-identifier hs-var">setConsoleMode</span></a><span> </span><a href="#local-6989586621679053579"><span class="hs-identifier hs-var">hOut</span></a><span> </span><a href="#local-6989586621679053581"><span class="hs-identifier hs-var">mOut'</span></a><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span class="hs-comment">-- This function tries to get a valid standard handle and throws an exception if</span><span>
</span><a name="line-92"></a><span class="hs-comment">-- it cannot.</span><span>
</span><a name="line-93"></a><span class="hs-identifier">getValidStdHandle</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DWORD</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">HANDLE</span><span>
</span><a name="line-94"></a><a name="getValidStdHandle"><a href="System.Console.ANSI.Windows.Detect.html#getValidStdHandle"><span class="hs-identifier">getValidStdHandle</span></a></a><span> </span><a name="local-6989586621679053582"><a href="#local-6989586621679053582"><span class="hs-identifier">nStdHandle</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-95"></a><span>    </span><a name="local-6989586621679053583"><a href="#local-6989586621679053583"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Console.ANSI.Windows.Foreign.html#getStdHandle"><span class="hs-identifier hs-var">getStdHandle</span></a><span> </span><a href="#local-6989586621679053582"><span class="hs-identifier hs-var">nStdHandle</span></a><span>
</span><a name="line-96"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679053583"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">iNVALID_HANDLE_VALUE</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679053583"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">nullHANDLE</span><span>
</span><a name="line-97"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">throwIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Console.ANSI.Windows.Foreign.html#ConsoleException"><span class="hs-identifier hs-var">ConsoleException</span></a><span> </span><span class="hs-number">6</span><span> </span><span class="hs-comment">-- Invalid Handle</span><span>
</span><a name="line-98"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679053583"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-99"></a></pre></body></html>